# 需求说明书

## 用户与信息模块

用户登录、注册、批量注册、退出登录、学院增删改查（字典）、专业增删改查（字典）、年级增删改查（字典）

## 权限与菜单模块

用户鉴权、api权限、菜单权限

## 成果管理模块

成果类型的增删改查、成果类型属性的增删改查、成果上传、成果修改、成果删除、成果统计分析、成果审核、成果通知、

成果分享：上传成果时可以选择是否他人可见

成果点赞：可以对他人分享的成果点赞

成果统计分析：可以通过对成果类型、获得时间、



## gozero

`goctl api go -api scholartrack.api -dir .`

`goctl rpc -o add.proto`

`goctl model mysql ddl -c -src book.sql -dir .`

`goctl rpc protoc -m system.proto --go_out=. --go-grpc_out=. --zrpc_out=.`

`--format=powershell 1.19 | Invoke-Expression`



## 问题

1. 如果rpc调用时间比较长，会在调用端返回`DeadlineExceeded desc = context deadline exceeded`,但是被调用端实际已经完成了操作，比如数据库插入的操作已经完成了。（未解决）
2. go: github.com/bearllflee/scholar-track/rpc/system/internal/server imports
        github.com/bearllflee/scholar-track/rpc/system/internal/logic: no matching versions for query "latest"
    
    ```go
    // Code generated by goctl. DO NOT EDIT.
    // goctl 1.7.3
    // Source: system.proto
    
    package server
    
    import (
    	"context"
    
    	"github.com/bearllflee/scholar-track/rpc/system/internal/logic"
    	"github.com/bearllflee/scholar-track/rpc/system/internal/svc"
    	"github.com/bearllflee/scholar-track/rpc/system/system"
    )
    
    type SystemServer struct {
    	svcCtx *svc.ServiceContext
    	system.UnimplementedSystemServer
    }
    
    func NewSystemServer(svcCtx *svc.ServiceContext) *SystemServer {
    	return &SystemServer{
    		svcCtx: svcCtx,
    	}
    }
    
    func (s *SystemServer) Ping(ctx context.Context, in *system.) (*system.Response, error) {
    	l := logic.NewPingLogic(ctx, s.svcCtx)
    	return l.Ping(in)
    }
    
    ```
3. packages.Load error: err: exit status 1: stderr: package unsafe is not in std (C:\Program Files\Go\bin\src\unsafe)
    原因是没有项目的goroot设置错误.
4. 在将项目由一个go.mod，改为多个go.mod时，遇到两个问题
    - go: github.com/bearllflee/scholar-track/api: ambiguous import: found package github.com/bearllflee/scholar-track/api in multiple modules: 
    这个是因为我本地项目和github的项目冲突了
    - replace github.com/bearllflee/scholar-track => ../../
    github.com/bearllflee/scholar-track/pkg/global: module github.com/bearllflee/scholar-track@latest found (v0.0.0-20250106084516-7ba3ba18f711, replaced by ../../), but does not contain package github.com/bearllflee/scholar-track/pkg/global
    这个是因为我项目根目录没有go.mod文件，所以replace找不到
## 优化
- [x] 把不需要返回的数据的json设置为 `-`
- [x] 统一一下uint64和int64以及int uint
- [ ] 删除角色时，如果角色下有用户或子角色，则不能删除
- [ ] 定义请求和返回时不要有那么多的嵌套字段，尽量重新定义
- [x] 可以在serviceContext中定义service，方便多个logic互相使用
- [ ] 在上一条的基础上，看看是否可以将判断用户是否存在、角色是否存在等逻辑封装起来（可以使用自定义校验器）
- [ ] 现在所有模块的proto文件、api文件都写在一起，后面需要分开。
- [ ] 有一些字段需要做长度限制，比如成果名称、成果描述等
- [ ] 添加字典和菜单相关的增删改查
- [ ] user role 这些查询看看能否使用预加载
